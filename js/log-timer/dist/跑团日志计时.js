// ==UserScript==
// @name         跑团日志计时
// @author       JustAnotherID
// @version      1.1.2
// @description  在使用 .log new/on/off/end/halt 命令时会提示本次跑团用时相关信息（该插件没有新增命令）
// @timestamp    2025-02-13 11:45:14
// @license      MIT
// @homepageURL  https://github.com/JustAnotherID/just-another-seal-mod-repo/tree/master/js/log-timer
// @updateUrl    https://ghproxy.justanotherid.com/https://raw.githubusercontent.com/JustAnotherID/just-another-seal-mod-repo/master/js/log-timer/dist/%E8%B7%91%E5%9B%A2%E6%97%A5%E5%BF%97%E8%AE%A1%E6%97%B6.js
// @updateUrl    https://raw.githubusercontent.com/JustAnotherID/just-another-seal-mod-repo/master/js/summer-creature/log-timer/%E8%B7%91%E5%9B%A2%E6%97%A5%E5%BF%97%E8%AE%A1%E6%97%B6.js
// ==/UserScript==

// Generated by ReScript, PLEASE EDIT WITH CARE
"use strict";
var __getOwnPropNames = Object.getOwnPropertyNames;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};

// node_modules/.pnpm/rescript@11.1.1/node_modules/rescript/lib/js/caml_option.js
var require_caml_option = __commonJS({
  "node_modules/.pnpm/rescript@11.1.1/node_modules/rescript/lib/js/caml_option.js"(exports2) {
    "use strict";
    function isNested(x) {
      return x.BS_PRIVATE_NESTED_SOME_NONE !== void 0;
    }
    function some(x) {
      if (x === void 0) {
        return {
          BS_PRIVATE_NESTED_SOME_NONE: 0
        };
      } else if (x !== null && x.BS_PRIVATE_NESTED_SOME_NONE !== void 0) {
        return {
          BS_PRIVATE_NESTED_SOME_NONE: x.BS_PRIVATE_NESTED_SOME_NONE + 1 | 0
        };
      } else {
        return x;
      }
    }
    function nullable_to_opt(x) {
      if (x == null) {
        return;
      } else {
        return some(x);
      }
    }
    function undefined_to_opt(x) {
      if (x === void 0) {
        return;
      } else {
        return some(x);
      }
    }
    function null_to_opt(x) {
      if (x === null) {
        return;
      } else {
        return some(x);
      }
    }
    function valFromOption(x) {
      if (!(x !== null && x.BS_PRIVATE_NESTED_SOME_NONE !== void 0)) {
        return x;
      }
      var depth = x.BS_PRIVATE_NESTED_SOME_NONE;
      if (depth === 0) {
        return;
      } else {
        return {
          BS_PRIVATE_NESTED_SOME_NONE: depth - 1 | 0
        };
      }
    }
    function option_get(x) {
      if (x === void 0) {
        return;
      } else {
        return valFromOption(x);
      }
    }
    function option_unwrap(x) {
      if (x !== void 0) {
        return x.VAL;
      } else {
        return x;
      }
    }
    exports2.nullable_to_opt = nullable_to_opt;
    exports2.undefined_to_opt = undefined_to_opt;
    exports2.null_to_opt = null_to_opt;
    exports2.valFromOption = valFromOption;
    exports2.some = some;
    exports2.isNested = isNested;
    exports2.option_get = option_get;
    exports2.option_unwrap = option_unwrap;
  }
});

// types/Seal.res.js
var require_Seal_res = __commonJS({
  "types/Seal.res.js"(exports2) {
    "use strict";
    var Caml_option2 = require_caml_option();
    function getKwargs(cmdArgs, name) {
      return Caml_option2.nullable_to_opt(cmdArgs.getKwargs(name));
    }
    function getArgN(cmdArgs, index) {
      return Caml_option2.nullable_to_opt(cmdArgs.getArgN(index));
    }
    function storageGet(extInfo, key) {
      return Caml_option2.nullable_to_opt(extInfo.storageGet(key));
    }
    function find(name) {
      return Caml_option2.nullable_to_opt(seal.ext.find(name));
    }
    var Ext = {
      find
    };
    function getUser(id) {
      return Caml_option2.nullable_to_opt(seal.ban.getUser(id));
    }
    var Ban = {
      getUser
    };
    function strGet(msgContext, key) {
      var match = seal.vars.strGet(msgContext, key);
      if (match[1]) {
        return match[0];
      }
    }
    function strSet(msgContext, key, value) {
      seal.vars.strSet(msgContext, key, value);
    }
    var Vars = {
      strGet,
      strSet
    };
    exports2.getKwargs = getKwargs;
    exports2.getArgN = getArgN;
    exports2.storageGet = storageGet;
    exports2.Ext = Ext;
    exports2.Ban = Ban;
    exports2.Vars = Vars;
  }
});

// node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/dayjs.min.js
var require_dayjs_min = __commonJS({
  "node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/dayjs.min.js"(exports2, module2) {
    !function(t, e) {
      "object" == typeof exports2 && "undefined" != typeof module2 ? module2.exports = e() : "function" == typeof define && define.amd ? define(e) : (t = "undefined" != typeof globalThis ? globalThis : t || self).dayjs = e();
    }(exports2, function() {
      "use strict";
      var t = 1e3, e = 6e4, n = 36e5, r = "millisecond", i = "second", s = "minute", u = "hour", a = "day", o = "week", c = "month", f = "quarter", h = "year", d = "date", l = "Invalid Date", $ = /^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/, y = /\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g, M = { name: "en", weekdays: "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"), months: "January_February_March_April_May_June_July_August_September_October_November_December".split("_"), ordinal: function(t2) {
        var e2 = ["th", "st", "nd", "rd"], n2 = t2 % 100;
        return "[" + t2 + (e2[(n2 - 20) % 10] || e2[n2] || e2[0]) + "]";
      } }, m = function(t2, e2, n2) {
        var r2 = String(t2);
        return !r2 || r2.length >= e2 ? t2 : "" + Array(e2 + 1 - r2.length).join(n2) + t2;
      }, v = { s: m, z: function(t2) {
        var e2 = -t2.utcOffset(), n2 = Math.abs(e2), r2 = Math.floor(n2 / 60), i2 = n2 % 60;
        return (e2 <= 0 ? "+" : "-") + m(r2, 2, "0") + ":" + m(i2, 2, "0");
      }, m: function t2(e2, n2) {
        if (e2.date() < n2.date()) return -t2(n2, e2);
        var r2 = 12 * (n2.year() - e2.year()) + (n2.month() - e2.month()), i2 = e2.clone().add(r2, c), s2 = n2 - i2 < 0, u2 = e2.clone().add(r2 + (s2 ? -1 : 1), c);
        return +(-(r2 + (n2 - i2) / (s2 ? i2 - u2 : u2 - i2)) || 0);
      }, a: function(t2) {
        return t2 < 0 ? Math.ceil(t2) || 0 : Math.floor(t2);
      }, p: function(t2) {
        return { M: c, y: h, w: o, d: a, D: d, h: u, m: s, s: i, ms: r, Q: f }[t2] || String(t2 || "").toLowerCase().replace(/s$/, "");
      }, u: function(t2) {
        return void 0 === t2;
      } }, g = "en", D = {};
      D[g] = M;
      var p = "$isDayjsObject", S = function(t2) {
        return t2 instanceof _ || !(!t2 || !t2[p]);
      }, w = function t2(e2, n2, r2) {
        var i2;
        if (!e2) return g;
        if ("string" == typeof e2) {
          var s2 = e2.toLowerCase();
          D[s2] && (i2 = s2), n2 && (D[s2] = n2, i2 = s2);
          var u2 = e2.split("-");
          if (!i2 && u2.length > 1) return t2(u2[0]);
        } else {
          var a2 = e2.name;
          D[a2] = e2, i2 = a2;
        }
        return !r2 && i2 && (g = i2), i2 || !r2 && g;
      }, O = function(t2, e2) {
        if (S(t2)) return t2.clone();
        var n2 = "object" == typeof e2 ? e2 : {};
        return n2.date = t2, n2.args = arguments, new _(n2);
      }, b = v;
      b.l = w, b.i = S, b.w = function(t2, e2) {
        return O(t2, { locale: e2.$L, utc: e2.$u, x: e2.$x, $offset: e2.$offset });
      };
      var _ = function() {
        function M2(t2) {
          this.$L = w(t2.locale, null, true), this.parse(t2), this.$x = this.$x || t2.x || {}, this[p] = true;
        }
        var m2 = M2.prototype;
        return m2.parse = function(t2) {
          this.$d = function(t3) {
            var e2 = t3.date, n2 = t3.utc;
            if (null === e2) return /* @__PURE__ */ new Date(NaN);
            if (b.u(e2)) return /* @__PURE__ */ new Date();
            if (e2 instanceof Date) return new Date(e2);
            if ("string" == typeof e2 && !/Z$/i.test(e2)) {
              var r2 = e2.match($);
              if (r2) {
                var i2 = r2[2] - 1 || 0, s2 = (r2[7] || "0").substring(0, 3);
                return n2 ? new Date(Date.UTC(r2[1], i2, r2[3] || 1, r2[4] || 0, r2[5] || 0, r2[6] || 0, s2)) : new Date(r2[1], i2, r2[3] || 1, r2[4] || 0, r2[5] || 0, r2[6] || 0, s2);
              }
            }
            return new Date(e2);
          }(t2), this.init();
        }, m2.init = function() {
          var t2 = this.$d;
          this.$y = t2.getFullYear(), this.$M = t2.getMonth(), this.$D = t2.getDate(), this.$W = t2.getDay(), this.$H = t2.getHours(), this.$m = t2.getMinutes(), this.$s = t2.getSeconds(), this.$ms = t2.getMilliseconds();
        }, m2.$utils = function() {
          return b;
        }, m2.isValid = function() {
          return !(this.$d.toString() === l);
        }, m2.isSame = function(t2, e2) {
          var n2 = O(t2);
          return this.startOf(e2) <= n2 && n2 <= this.endOf(e2);
        }, m2.isAfter = function(t2, e2) {
          return O(t2) < this.startOf(e2);
        }, m2.isBefore = function(t2, e2) {
          return this.endOf(e2) < O(t2);
        }, m2.$g = function(t2, e2, n2) {
          return b.u(t2) ? this[e2] : this.set(n2, t2);
        }, m2.unix = function() {
          return Math.floor(this.valueOf() / 1e3);
        }, m2.valueOf = function() {
          return this.$d.getTime();
        }, m2.startOf = function(t2, e2) {
          var n2 = this, r2 = !!b.u(e2) || e2, f2 = b.p(t2), l2 = function(t3, e3) {
            var i2 = b.w(n2.$u ? Date.UTC(n2.$y, e3, t3) : new Date(n2.$y, e3, t3), n2);
            return r2 ? i2 : i2.endOf(a);
          }, $2 = function(t3, e3) {
            return b.w(n2.toDate()[t3].apply(n2.toDate("s"), (r2 ? [0, 0, 0, 0] : [23, 59, 59, 999]).slice(e3)), n2);
          }, y2 = this.$W, M3 = this.$M, m3 = this.$D, v2 = "set" + (this.$u ? "UTC" : "");
          switch (f2) {
            case h:
              return r2 ? l2(1, 0) : l2(31, 11);
            case c:
              return r2 ? l2(1, M3) : l2(0, M3 + 1);
            case o:
              var g2 = this.$locale().weekStart || 0, D2 = (y2 < g2 ? y2 + 7 : y2) - g2;
              return l2(r2 ? m3 - D2 : m3 + (6 - D2), M3);
            case a:
            case d:
              return $2(v2 + "Hours", 0);
            case u:
              return $2(v2 + "Minutes", 1);
            case s:
              return $2(v2 + "Seconds", 2);
            case i:
              return $2(v2 + "Milliseconds", 3);
            default:
              return this.clone();
          }
        }, m2.endOf = function(t2) {
          return this.startOf(t2, false);
        }, m2.$set = function(t2, e2) {
          var n2, o2 = b.p(t2), f2 = "set" + (this.$u ? "UTC" : ""), l2 = (n2 = {}, n2[a] = f2 + "Date", n2[d] = f2 + "Date", n2[c] = f2 + "Month", n2[h] = f2 + "FullYear", n2[u] = f2 + "Hours", n2[s] = f2 + "Minutes", n2[i] = f2 + "Seconds", n2[r] = f2 + "Milliseconds", n2)[o2], $2 = o2 === a ? this.$D + (e2 - this.$W) : e2;
          if (o2 === c || o2 === h) {
            var y2 = this.clone().set(d, 1);
            y2.$d[l2]($2), y2.init(), this.$d = y2.set(d, Math.min(this.$D, y2.daysInMonth())).$d;
          } else l2 && this.$d[l2]($2);
          return this.init(), this;
        }, m2.set = function(t2, e2) {
          return this.clone().$set(t2, e2);
        }, m2.get = function(t2) {
          return this[b.p(t2)]();
        }, m2.add = function(r2, f2) {
          var d2, l2 = this;
          r2 = Number(r2);
          var $2 = b.p(f2), y2 = function(t2) {
            var e2 = O(l2);
            return b.w(e2.date(e2.date() + Math.round(t2 * r2)), l2);
          };
          if ($2 === c) return this.set(c, this.$M + r2);
          if ($2 === h) return this.set(h, this.$y + r2);
          if ($2 === a) return y2(1);
          if ($2 === o) return y2(7);
          var M3 = (d2 = {}, d2[s] = e, d2[u] = n, d2[i] = t, d2)[$2] || 1, m3 = this.$d.getTime() + r2 * M3;
          return b.w(m3, this);
        }, m2.subtract = function(t2, e2) {
          return this.add(-1 * t2, e2);
        }, m2.format = function(t2) {
          var e2 = this, n2 = this.$locale();
          if (!this.isValid()) return n2.invalidDate || l;
          var r2 = t2 || "YYYY-MM-DDTHH:mm:ssZ", i2 = b.z(this), s2 = this.$H, u2 = this.$m, a2 = this.$M, o2 = n2.weekdays, c2 = n2.months, f2 = n2.meridiem, h2 = function(t3, n3, i3, s3) {
            return t3 && (t3[n3] || t3(e2, r2)) || i3[n3].slice(0, s3);
          }, d2 = function(t3) {
            return b.s(s2 % 12 || 12, t3, "0");
          }, $2 = f2 || function(t3, e3, n3) {
            var r3 = t3 < 12 ? "AM" : "PM";
            return n3 ? r3.toLowerCase() : r3;
          };
          return r2.replace(y, function(t3, r3) {
            return r3 || function(t4) {
              switch (t4) {
                case "YY":
                  return String(e2.$y).slice(-2);
                case "YYYY":
                  return b.s(e2.$y, 4, "0");
                case "M":
                  return a2 + 1;
                case "MM":
                  return b.s(a2 + 1, 2, "0");
                case "MMM":
                  return h2(n2.monthsShort, a2, c2, 3);
                case "MMMM":
                  return h2(c2, a2);
                case "D":
                  return e2.$D;
                case "DD":
                  return b.s(e2.$D, 2, "0");
                case "d":
                  return String(e2.$W);
                case "dd":
                  return h2(n2.weekdaysMin, e2.$W, o2, 2);
                case "ddd":
                  return h2(n2.weekdaysShort, e2.$W, o2, 3);
                case "dddd":
                  return o2[e2.$W];
                case "H":
                  return String(s2);
                case "HH":
                  return b.s(s2, 2, "0");
                case "h":
                  return d2(1);
                case "hh":
                  return d2(2);
                case "a":
                  return $2(s2, u2, true);
                case "A":
                  return $2(s2, u2, false);
                case "m":
                  return String(u2);
                case "mm":
                  return b.s(u2, 2, "0");
                case "s":
                  return String(e2.$s);
                case "ss":
                  return b.s(e2.$s, 2, "0");
                case "SSS":
                  return b.s(e2.$ms, 3, "0");
                case "Z":
                  return i2;
              }
              return null;
            }(t3) || i2.replace(":", "");
          });
        }, m2.utcOffset = function() {
          return 15 * -Math.round(this.$d.getTimezoneOffset() / 15);
        }, m2.diff = function(r2, d2, l2) {
          var $2, y2 = this, M3 = b.p(d2), m3 = O(r2), v2 = (m3.utcOffset() - this.utcOffset()) * e, g2 = this - m3, D2 = function() {
            return b.m(y2, m3);
          };
          switch (M3) {
            case h:
              $2 = D2() / 12;
              break;
            case c:
              $2 = D2();
              break;
            case f:
              $2 = D2() / 3;
              break;
            case o:
              $2 = (g2 - v2) / 6048e5;
              break;
            case a:
              $2 = (g2 - v2) / 864e5;
              break;
            case u:
              $2 = g2 / n;
              break;
            case s:
              $2 = g2 / e;
              break;
            case i:
              $2 = g2 / t;
              break;
            default:
              $2 = g2;
          }
          return l2 ? $2 : b.a($2);
        }, m2.daysInMonth = function() {
          return this.endOf(c).$D;
        }, m2.$locale = function() {
          return D[this.$L];
        }, m2.locale = function(t2, e2) {
          if (!t2) return this.$L;
          var n2 = this.clone(), r2 = w(t2, e2, true);
          return r2 && (n2.$L = r2), n2;
        }, m2.clone = function() {
          return b.w(this.$d, this);
        }, m2.toDate = function() {
          return new Date(this.valueOf());
        }, m2.toJSON = function() {
          return this.isValid() ? this.toISOString() : null;
        }, m2.toISOString = function() {
          return this.$d.toISOString();
        }, m2.toString = function() {
          return this.$d.toUTCString();
        }, M2;
      }(), k = _.prototype;
      return O.prototype = k, [["$ms", r], ["$s", i], ["$m", s], ["$H", u], ["$W", a], ["$M", c], ["$y", h], ["$D", d]].forEach(function(t2) {
        k[t2[1]] = function(e2) {
          return this.$g(e2, t2[0], t2[1]);
        };
      }), O.extend = function(t2, e2) {
        return t2.$i || (t2(e2, _, O), t2.$i = true), O;
      }, O.locale = w, O.isDayjs = S, O.unix = function(t2) {
        return O(1e3 * t2);
      }, O.en = D[g], O.Ls = D, O.p = {}, O;
    });
  }
});

// node_modules/.pnpm/@rescript+core@1.5.0_rescript@11.1.1/node_modules/@rescript/core/src/Core__Error.res.js
var require_Core_Error_res = __commonJS({
  "node_modules/.pnpm/@rescript+core@1.5.0_rescript@11.1.1/node_modules/@rescript/core/src/Core__Error.res.js"(exports2) {
    "use strict";
    var $$EvalError = {};
    var $$RangeError = {};
    var $$ReferenceError = {};
    var $$SyntaxError = {};
    var $$TypeError = {};
    var $$URIError = {};
    function panic(msg) {
      throw new Error("Panic! " + msg);
    }
    exports2.$$EvalError = $$EvalError;
    exports2.$$RangeError = $$RangeError;
    exports2.$$ReferenceError = $$ReferenceError;
    exports2.$$SyntaxError = $$SyntaxError;
    exports2.$$TypeError = $$TypeError;
    exports2.$$URIError = $$URIError;
    exports2.panic = panic;
  }
});

// node_modules/.pnpm/@rescript+core@1.5.0_rescript@11.1.1/node_modules/@rescript/core/src/Core__Option.res.js
var require_Core_Option_res = __commonJS({
  "node_modules/.pnpm/@rescript+core@1.5.0_rescript@11.1.1/node_modules/@rescript/core/src/Core__Option.res.js"(exports2) {
    "use strict";
    var Caml_option2 = require_caml_option();
    var Core__Error = require_Core_Error_res();
    function filter(opt, p) {
      if (opt !== void 0 && p(Caml_option2.valFromOption(opt))) {
        return opt;
      }
    }
    function forEach(opt, f) {
      if (opt !== void 0) {
        return f(Caml_option2.valFromOption(opt));
      }
    }
    function getExn(x, message) {
      if (x !== void 0) {
        return Caml_option2.valFromOption(x);
      } else {
        return Core__Error.panic(message !== void 0 ? message : "Option.getExn called for None value");
      }
    }
    function mapOr(opt, $$default, f) {
      if (opt !== void 0) {
        return f(Caml_option2.valFromOption(opt));
      } else {
        return $$default;
      }
    }
    function map(opt, f) {
      if (opt !== void 0) {
        return Caml_option2.some(f(Caml_option2.valFromOption(opt)));
      }
    }
    function flatMap(opt, f) {
      if (opt !== void 0) {
        return f(Caml_option2.valFromOption(opt));
      }
    }
    function getOr(opt, $$default) {
      if (opt !== void 0) {
        return Caml_option2.valFromOption(opt);
      } else {
        return $$default;
      }
    }
    function orElse(opt, other) {
      if (opt !== void 0) {
        return opt;
      } else {
        return other;
      }
    }
    function isSome(x) {
      return x !== void 0;
    }
    function isNone(x) {
      return x === void 0;
    }
    function equal(a, b, eq) {
      if (a !== void 0) {
        if (b !== void 0) {
          return eq(Caml_option2.valFromOption(a), Caml_option2.valFromOption(b));
        } else {
          return false;
        }
      } else {
        return b === void 0;
      }
    }
    function compare(a, b, cmp) {
      if (a !== void 0) {
        if (b !== void 0) {
          return cmp(Caml_option2.valFromOption(a), Caml_option2.valFromOption(b));
        } else {
          return 1;
        }
      } else if (b !== void 0) {
        return -1;
      } else {
        return 0;
      }
    }
    var mapWithDefault = mapOr;
    var getWithDefault = getOr;
    exports2.filter = filter;
    exports2.forEach = forEach;
    exports2.getExn = getExn;
    exports2.mapOr = mapOr;
    exports2.mapWithDefault = mapWithDefault;
    exports2.map = map;
    exports2.flatMap = flatMap;
    exports2.getOr = getOr;
    exports2.getWithDefault = getWithDefault;
    exports2.orElse = orElse;
    exports2.isSome = isSome;
    exports2.isNone = isNone;
    exports2.equal = equal;
    exports2.compare = compare;
  }
});

// node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/locale/zh-cn.js
var require_zh_cn = __commonJS({
  "node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/locale/zh-cn.js"(exports2, module2) {
    !function(e, _) {
      "object" == typeof exports2 && "undefined" != typeof module2 ? module2.exports = _(require_dayjs_min()) : "function" == typeof define && define.amd ? define(["dayjs"], _) : (e = "undefined" != typeof globalThis ? globalThis : e || self).dayjs_locale_zh_cn = _(e.dayjs);
    }(exports2, function(e) {
      "use strict";
      function _(e2) {
        return e2 && "object" == typeof e2 && "default" in e2 ? e2 : { default: e2 };
      }
      var t = _(e), d = { name: "zh-cn", weekdays: "星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"), weekdaysShort: "周日_周一_周二_周三_周四_周五_周六".split("_"), weekdaysMin: "日_一_二_三_四_五_六".split("_"), months: "一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"), monthsShort: "1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"), ordinal: function(e2, _2) {
        return "W" === _2 ? e2 + "周" : e2 + "日";
      }, weekStart: 1, yearStart: 4, formats: { LT: "HH:mm", LTS: "HH:mm:ss", L: "YYYY/MM/DD", LL: "YYYY年M月D日", LLL: "YYYY年M月D日Ah点mm分", LLLL: "YYYY年M月D日ddddAh点mm分", l: "YYYY/M/D", ll: "YYYY年M月D日", lll: "YYYY年M月D日 HH:mm", llll: "YYYY年M月D日dddd HH:mm" }, relativeTime: { future: "%s内", past: "%s前", s: "几秒", m: "1 分钟", mm: "%d 分钟", h: "1 小时", hh: "%d 小时", d: "1 天", dd: "%d 天", M: "1 个月", MM: "%d 个月", y: "1 年", yy: "%d 年" }, meridiem: function(e2, _2) {
        var t2 = 100 * e2 + _2;
        return t2 < 600 ? "凌晨" : t2 < 900 ? "早上" : t2 < 1100 ? "上午" : t2 < 1300 ? "中午" : t2 < 1800 ? "下午" : "晚上";
      } };
      return t.default.locale(d, null, true), d;
    });
  }
});

// node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/plugin/duration.js
var require_duration = __commonJS({
  "node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/plugin/duration.js"(exports2, module2) {
    !function(t, s) {
      "object" == typeof exports2 && "undefined" != typeof module2 ? module2.exports = s() : "function" == typeof define && define.amd ? define(s) : (t = "undefined" != typeof globalThis ? globalThis : t || self).dayjs_plugin_duration = s();
    }(exports2, function() {
      "use strict";
      var t, s, n = 1e3, i = 6e4, e = 36e5, r = 864e5, o = /\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g, u = 31536e6, d = 2628e6, a = /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/, h = { years: u, months: d, days: r, hours: e, minutes: i, seconds: n, milliseconds: 1, weeks: 6048e5 }, c = function(t2) {
        return t2 instanceof g;
      }, f = function(t2, s2, n2) {
        return new g(t2, n2, s2.$l);
      }, m = function(t2) {
        return s.p(t2) + "s";
      }, l = function(t2) {
        return t2 < 0;
      }, $ = function(t2) {
        return l(t2) ? Math.ceil(t2) : Math.floor(t2);
      }, y = function(t2) {
        return Math.abs(t2);
      }, v = function(t2, s2) {
        return t2 ? l(t2) ? { negative: true, format: "" + y(t2) + s2 } : { negative: false, format: "" + t2 + s2 } : { negative: false, format: "" };
      }, g = function() {
        function l2(t2, s2, n2) {
          var i2 = this;
          if (this.$d = {}, this.$l = n2, void 0 === t2 && (this.$ms = 0, this.parseFromMilliseconds()), s2) return f(t2 * h[m(s2)], this);
          if ("number" == typeof t2) return this.$ms = t2, this.parseFromMilliseconds(), this;
          if ("object" == typeof t2) return Object.keys(t2).forEach(function(s3) {
            i2.$d[m(s3)] = t2[s3];
          }), this.calMilliseconds(), this;
          if ("string" == typeof t2) {
            var e2 = t2.match(a);
            if (e2) {
              var r2 = e2.slice(2).map(function(t3) {
                return null != t3 ? Number(t3) : 0;
              });
              return this.$d.years = r2[0], this.$d.months = r2[1], this.$d.weeks = r2[2], this.$d.days = r2[3], this.$d.hours = r2[4], this.$d.minutes = r2[5], this.$d.seconds = r2[6], this.calMilliseconds(), this;
            }
          }
          return this;
        }
        var y2 = l2.prototype;
        return y2.calMilliseconds = function() {
          var t2 = this;
          this.$ms = Object.keys(this.$d).reduce(function(s2, n2) {
            return s2 + (t2.$d[n2] || 0) * h[n2];
          }, 0);
        }, y2.parseFromMilliseconds = function() {
          var t2 = this.$ms;
          this.$d.years = $(t2 / u), t2 %= u, this.$d.months = $(t2 / d), t2 %= d, this.$d.days = $(t2 / r), t2 %= r, this.$d.hours = $(t2 / e), t2 %= e, this.$d.minutes = $(t2 / i), t2 %= i, this.$d.seconds = $(t2 / n), t2 %= n, this.$d.milliseconds = t2;
        }, y2.toISOString = function() {
          var t2 = v(this.$d.years, "Y"), s2 = v(this.$d.months, "M"), n2 = +this.$d.days || 0;
          this.$d.weeks && (n2 += 7 * this.$d.weeks);
          var i2 = v(n2, "D"), e2 = v(this.$d.hours, "H"), r2 = v(this.$d.minutes, "M"), o2 = this.$d.seconds || 0;
          this.$d.milliseconds && (o2 += this.$d.milliseconds / 1e3, o2 = Math.round(1e3 * o2) / 1e3);
          var u2 = v(o2, "S"), d2 = t2.negative || s2.negative || i2.negative || e2.negative || r2.negative || u2.negative, a2 = e2.format || r2.format || u2.format ? "T" : "", h2 = (d2 ? "-" : "") + "P" + t2.format + s2.format + i2.format + a2 + e2.format + r2.format + u2.format;
          return "P" === h2 || "-P" === h2 ? "P0D" : h2;
        }, y2.toJSON = function() {
          return this.toISOString();
        }, y2.format = function(t2) {
          var n2 = t2 || "YYYY-MM-DDTHH:mm:ss", i2 = { Y: this.$d.years, YY: s.s(this.$d.years, 2, "0"), YYYY: s.s(this.$d.years, 4, "0"), M: this.$d.months, MM: s.s(this.$d.months, 2, "0"), D: this.$d.days, DD: s.s(this.$d.days, 2, "0"), H: this.$d.hours, HH: s.s(this.$d.hours, 2, "0"), m: this.$d.minutes, mm: s.s(this.$d.minutes, 2, "0"), s: this.$d.seconds, ss: s.s(this.$d.seconds, 2, "0"), SSS: s.s(this.$d.milliseconds, 3, "0") };
          return n2.replace(o, function(t3, s2) {
            return s2 || String(i2[t3]);
          });
        }, y2.as = function(t2) {
          return this.$ms / h[m(t2)];
        }, y2.get = function(t2) {
          var s2 = this.$ms, n2 = m(t2);
          return "milliseconds" === n2 ? s2 %= 1e3 : s2 = "weeks" === n2 ? $(s2 / h[n2]) : this.$d[n2], s2 || 0;
        }, y2.add = function(t2, s2, n2) {
          var i2;
          return i2 = s2 ? t2 * h[m(s2)] : c(t2) ? t2.$ms : f(t2, this).$ms, f(this.$ms + i2 * (n2 ? -1 : 1), this);
        }, y2.subtract = function(t2, s2) {
          return this.add(t2, s2, true);
        }, y2.locale = function(t2) {
          var s2 = this.clone();
          return s2.$l = t2, s2;
        }, y2.clone = function() {
          return f(this.$ms, this);
        }, y2.humanize = function(s2) {
          return t().add(this.$ms, "ms").locale(this.$l).fromNow(!s2);
        }, y2.valueOf = function() {
          return this.asMilliseconds();
        }, y2.milliseconds = function() {
          return this.get("milliseconds");
        }, y2.asMilliseconds = function() {
          return this.as("milliseconds");
        }, y2.seconds = function() {
          return this.get("seconds");
        }, y2.asSeconds = function() {
          return this.as("seconds");
        }, y2.minutes = function() {
          return this.get("minutes");
        }, y2.asMinutes = function() {
          return this.as("minutes");
        }, y2.hours = function() {
          return this.get("hours");
        }, y2.asHours = function() {
          return this.as("hours");
        }, y2.days = function() {
          return this.get("days");
        }, y2.asDays = function() {
          return this.as("days");
        }, y2.weeks = function() {
          return this.get("weeks");
        }, y2.asWeeks = function() {
          return this.as("weeks");
        }, y2.months = function() {
          return this.get("months");
        }, y2.asMonths = function() {
          return this.as("months");
        }, y2.years = function() {
          return this.get("years");
        }, y2.asYears = function() {
          return this.as("years");
        }, l2;
      }(), p = function(t2, s2, n2) {
        return t2.add(s2.years() * n2, "y").add(s2.months() * n2, "M").add(s2.days() * n2, "d").add(s2.hours() * n2, "h").add(s2.minutes() * n2, "m").add(s2.seconds() * n2, "s").add(s2.milliseconds() * n2, "ms");
      };
      return function(n2, i2, e2) {
        t = e2, s = e2().$utils(), e2.duration = function(t2, s2) {
          var n3 = e2.locale();
          return f(t2, { $l: n3 }, s2);
        }, e2.isDuration = c;
        var r2 = i2.prototype.add, o2 = i2.prototype.subtract;
        i2.prototype.add = function(t2, s2) {
          return c(t2) ? p(this, t2, 1) : r2.bind(this)(t2, s2);
        }, i2.prototype.subtract = function(t2, s2) {
          return c(t2) ? p(this, t2, -1) : o2.bind(this)(t2, s2);
        };
      };
    });
  }
});

// node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/plugin/relativeTime.js
var require_relativeTime = __commonJS({
  "node_modules/.pnpm/dayjs@1.11.11/node_modules/dayjs/plugin/relativeTime.js"(exports2, module2) {
    !function(r, e) {
      "object" == typeof exports2 && "undefined" != typeof module2 ? module2.exports = e() : "function" == typeof define && define.amd ? define(e) : (r = "undefined" != typeof globalThis ? globalThis : r || self).dayjs_plugin_relativeTime = e();
    }(exports2, function() {
      "use strict";
      return function(r, e, t) {
        r = r || {};
        var n = e.prototype, o = { future: "in %s", past: "%s ago", s: "a few seconds", m: "a minute", mm: "%d minutes", h: "an hour", hh: "%d hours", d: "a day", dd: "%d days", M: "a month", MM: "%d months", y: "a year", yy: "%d years" };
        function i(r2, e2, t2, o2) {
          return n.fromToBase(r2, e2, t2, o2);
        }
        t.en.relativeTime = o, n.fromToBase = function(e2, n2, i2, d2, u) {
          for (var f, a, s, l = i2.$locale().relativeTime || o, h = r.thresholds || [{ l: "s", r: 44, d: "second" }, { l: "m", r: 89 }, { l: "mm", r: 44, d: "minute" }, { l: "h", r: 89 }, { l: "hh", r: 21, d: "hour" }, { l: "d", r: 35 }, { l: "dd", r: 25, d: "day" }, { l: "M", r: 45 }, { l: "MM", r: 10, d: "month" }, { l: "y", r: 17 }, { l: "yy", d: "year" }], m = h.length, c = 0; c < m; c += 1) {
            var y = h[c];
            y.d && (f = d2 ? t(e2).diff(i2, y.d, true) : i2.diff(e2, y.d, true));
            var p = (r.rounding || Math.round)(Math.abs(f));
            if (s = f > 0, p <= y.r || !y.r) {
              p <= 1 && c > 0 && (y = h[c - 1]);
              var v = l[y.l];
              u && (p = u("" + p)), a = "string" == typeof v ? v.replace("%d", p) : v(p, n2, y.l, s);
              break;
            }
          }
          if (n2) return a;
          var M = s ? l.future : l.past;
          return "function" == typeof M ? M(a) : M.replace("%s", a);
        }, n.to = function(r2, e2) {
          return i(r2, e2, this, true);
        }, n.from = function(r2, e2) {
          return i(r2, e2, this);
        };
        var d = function(r2) {
          return r2.$u ? t.utc() : t();
        };
        n.toNow = function(r2) {
          return this.to(d(this), r2);
        }, n.fromNow = function(r2) {
          return this.from(d(this), r2);
        };
      };
    });
  }
});

// src/Index.res.js
var Seal = require_Seal_res();
var Dayjs = require_dayjs_min();
var Caml_option = require_caml_option();
var Core__Option = require_Core_Option_res();
var ZhCn = require_zh_cn();
var Duration = require_duration();
var RelativeTime = require_relativeTime();
Dayjs.locale("zh-cn");
Dayjs.extend(Duration);
Dayjs.extend(RelativeTime);
function formatMilliseconds(milliseconds) {
  var hourSec = 60 * 60;
  var seconds = milliseconds / 1e3;
  var hh = Math.floor(seconds / hourSec);
  var hhStr = hh.toString();
  var mm = Math.floor(seconds % hourSec / 60);
  var mmStr = mm.toString();
  var ss = Math.floor(seconds % 60);
  var ssStr = ss.toString();
  if (hh > 0) {
    return hhStr + "小时" + mmStr + "分钟" + ssStr + "秒";
  } else if (mm > 0) {
    return mmStr + "分钟" + ssStr + "秒";
  } else {
    return ssStr + "秒";
  }
}
function generateStorageLogTimeKey(groupId, logName) {
  return "LOG_TIMER_" + groupId + "_" + logName;
}
function logBegin(extInfo, msgContext, groupId) {
  var logNameVar = Seal.Vars.strGet(msgContext, "$t记录名称");
  var logName = Core__Option.getOr(logNameVar, "");
  var key = generateStorageLogTimeKey(groupId, logName);
  var now = Date.now();
  var json = Seal.storageGet(extInfo, key);
  if (json !== void 0 && json !== "") {
    var old = JSON.parse(json);
    if (old.begin) {
      return {
        TAG: "Error",
        _0: "记录" + logName + "已在计时中"
      };
    }
    var new_totalTime = old.totalTime;
    var new_lastEndTime = old.lastEndTime;
    var $$new = {
      begin: true,
      totalTime: new_totalTime,
      lastBeginTime: now,
      lastEndTime: new_lastEndTime
    };
    var json$1 = JSON.stringify($$new);
    if (json$1 !== void 0) {
      extInfo.storageSet(key, json$1);
      return {
        TAG: "Ok",
        _0: {
          new: false,
          logName,
          lastEndTime: old.lastEndTime,
          totalTime: old.totalTime
        }
      };
    } else {
      return {
        TAG: "Error",
        _0: "未知错误(001)"
      };
    }
  }
  var info = {
    begin: true,
    totalTime: 0,
    lastBeginTime: now,
    lastEndTime: now
  };
  var json$2 = JSON.stringify(info);
  if (json$2 !== void 0) {
    extInfo.storageSet(key, json$2);
    return {
      TAG: "Ok",
      _0: {
        new: true,
        logName,
        lastEndTime: now,
        totalTime: 0
      }
    };
  } else {
    return {
      TAG: "Error",
      _0: "未知错误(002)"
    };
  }
}
function logEnd(extInfo, msgContext, groupId) {
  var logNameVar = Seal.Vars.strGet(msgContext, "$t记录名称");
  var logName = Core__Option.getOr(logNameVar, "");
  var key = generateStorageLogTimeKey(groupId, logName);
  var now = Date.now();
  var json = Seal.storageGet(extInfo, key);
  if (json === void 0) {
    return {
      TAG: "Error",
      _0: "无记录<" + logName + ">的计时信息"
    };
  }
  if (json === "") {
    return {
      TAG: "Error",
      _0: "无记录<" + logName + ">的计时信息"
    };
  }
  var old = JSON.parse(json);
  if (!old.begin) {
    return {
      TAG: "Error",
      _0: ""
    };
  }
  var currentTime = now - old.lastBeginTime;
  var new_totalTime = old.totalTime + currentTime;
  var new_lastBeginTime = old.lastBeginTime;
  var $$new = {
    begin: false,
    totalTime: new_totalTime,
    lastBeginTime: new_lastBeginTime,
    lastEndTime: now
  };
  var json$1 = JSON.stringify($$new);
  if (json$1 !== void 0) {
    extInfo.storageSet(key, json$1);
    return {
      TAG: "Ok",
      _0: {
        logName,
        totalTime: new_totalTime,
        currentTime
      }
    };
  } else {
    return {
      TAG: "Error",
      _0: "未知错误(003)"
    };
  }
}
function main() {
  var e = Seal.Ext.find("log-timer");
  var ext;
  if (e !== void 0) {
    ext = Caml_option.valFromOption(e);
  } else {
    var temp = seal.ext.new("log-timer", "JustAnotherID", "1.1.1");
    seal.ext.register(temp);
    ext = temp;
  }
  ext.onCommandReceived = function(msgContext, message, cmdArgs) {
    if (!(message.messageType === "group" && cmdArgs.command === "log" && cmdArgs.args.length > 0)) {
      return;
    }
    var s = cmdArgs.args[0];
    var match;
    if (s !== void 0) {
      var exit = 0;
      switch (s) {
        case "end":
        case "halt":
        case "new":
        case "off":
        case "on":
          exit = 1;
          break;
        default:
          match = s.startsWith("new") ? [
            "new",
            s.slice(3)
          ] : s.startsWith("on") ? [
            "on",
            s.slice(2)
          ] : s.startsWith("off") ? [
            "off",
            s.slice(3)
          ] : s.startsWith("end") ? [
            "end",
            s.slice(3)
          ] : s.startsWith("halt") ? [
            "halt",
            s.slice(4)
          ] : [
            void 0,
            void 0
          ];
      }
      if (exit === 1) {
        match = [
          s,
          cmdArgs.args[1]
        ];
      }
    } else {
      match = [
        void 0,
        void 0
      ];
    }
    var arg1 = match[1];
    var arg0 = match[0];
    var msg;
    var exit$1 = 0;
    if (arg0 !== void 0) {
      switch (arg0) {
        case "end":
        case "halt":
        case "off":
          exit$1 = 2;
          break;
        case "new":
        case "on":
          exit$1 = 1;
          break;
        default:
          msg = void 0;
      }
    } else {
      msg = void 0;
    }
    switch (exit$1) {
      case 1:
        if (arg1 !== void 0 && arg1 !== "") {
          Seal.Vars.strSet(msgContext, "$t记录名称", arg1);
          var beginResult = logBegin(ext, msgContext, message.groupId);
          if (beginResult.TAG === "Ok") {
            var result = beginResult._0;
            if (result.new) {
              var now = Dayjs().format("YYYY-MM-DD HH:mm:ss");
              msg = "新记录「" + result.logName + "」于" + now + "开始计时";
            } else {
              var now$1 = Dayjs().format("YYYY-MM-DD HH:mm:ss");
              var lastEndTime = Dayjs(result.lastEndTime).format("YYYY-MM-DD HH:mm:ss");
              var lastEndTimeDesc = Dayjs(result.lastEndTime).fromNow(void 0);
              var totalTime = formatMilliseconds(result.totalTime);
              msg = "记录「" + result.logName + "」于" + now$1 + "开始计时\n截止目前累计时长：" + totalTime + "\n上一次于" + lastEndTimeDesc + "（" + lastEndTime + "）停止计时";
            }
          } else {
            msg = beginResult._0;
          }
        } else {
          msg = "未指定记录名称，无法启动计时";
        }
        break;
      case 2:
        var endResult = logEnd(ext, msgContext, message.groupId);
        if (endResult.TAG === "Ok") {
          var result$1 = endResult._0;
          var now$2 = Dayjs().format("YYYY-MM-DD HH:mm:ss");
          var currentTime = formatMilliseconds(result$1.currentTime);
          var totalTime$1 = formatMilliseconds(result$1.totalTime);
          msg = "记录「" + result$1.logName + "」于" + now$2 + "停止计时\n本次时长：" + currentTime + "\n目前累计时长：" + totalTime$1;
        } else {
          msg = endResult._0;
        }
        break;
    }
    if (msg === void 0) {
      return;
    }
    if (msg === "") {
      return;
    }
    seal.replyToSender(msgContext, message, msg);
  };
}
main();
exports.formatMilliseconds = formatMilliseconds;
exports.generateStorageLogTimeKey = generateStorageLogTimeKey;
exports.logBegin = logBegin;
exports.logEnd = logEnd;
exports.main = main;
